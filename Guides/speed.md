# Размисли върху скоростта на печат ...
### ...и защо няма "значение".

## Няколко термина.
* Скорост на печат (Speed, Velocity, Feedrate) - Каква е *желаната* скорост за движение на главата. Измерва се в мм/с.
* Ускорение (Acceleration) - Колко бързо може да ускорява главата. Измервасе в мм/с².

## Разаснение за скоростта и ускорението.
За да се движи един обект с дадена скорост той трябва да ускори до тази скорост и да може да я поддържа. При 3Д притерите това зависи от моторите и съпротивителните сили. Затова и скростта която задаваме е *желана*, защото движението може да е по-късо от необходимото ни разстояние или да нямаме сила да развием тази скорост, да не забравяме - трябва да спрем или променим посоката на движение след извършване на движението. Ако подадем на принтера параметри, който той не може да изпълни то той ще избуксува или в краен случай ще претовари мотора и платката която я управлява и може да има перманентни щети. При буксуване (Step Skipping) това което се случва е мотора пропуска стъпки и се получава изместване (Layer Shifting) по остта по която е станало буксуването, защото той си мисли че е изпълнил правилно командата, но реално главата се е преместила по-малко. Понеже FDM технологията е бавна, а ние искаме да печатаме бързо търсим начини как да ускорим работата на принтера. Ако вдигнем скростта ще печатаме по-бързо, но ако нямаме достатъчно дълга права линия започваме да търсим по-добро ускорение.

## Ограниченията.
Максималната скорост при празно движение е доста висока, общо взето зависи от това колко бързо могат да се въртят моторите и колко ни е дълго движението. Но ограничението при печат/екструдиране идва от възможността на екструдера да екструдира материал. Разбира се с условието, че няма други фактори, а то има, но за тях по-късно, нека се съсредоточим върхучистата максимална скорост. 

- Как да намерим максимална скорост на печат - пускаме екструдера колкото се може по-бързо да екструдира и наблюдаваме кога ще прескочи мотора или ще прегрезе материала, ако върти и не излиза материал значи е прегрезан, а ако се чуват странни чукащи звуци от мотора то той превърта, като знаем колко е дебел филамента то можем да намерим колко е обема материал който може екструдера ни да избутва (измерва се в мм³/с). След като знаем, дебелината и височината на линията която искаме да напечатаме, намираме и нашата максимална скорост с която може да ни се движи главата. Ако избутваме 35мм/с, то обработваме 8.42 mm³/s, при височина 0.2мм и широчина 0.44мм е 90мм/с. (Ако намалим височината то и скоростта ще се увеличи)

Но не винаги имаме място да развием такива скорости и за да постигнем по-бърз резултат трябва да вдигнем ускорението.
- Как да намерим ускорението - ограничението там е силата на моторите и най-тежката част. При принтерите където леглото се движи в печатащата равнина, почти винаги то е ограничителя. Та пускаме движение по Y с различни ускорения и гледаме кога мотора ще започне да прескача, това ускорението което не бива да надвишаваме. Ако ускорението ни е 2000мм/с² то ще достигаме нашата желана скорост след 2мм, да не забравяме че трябва и да спрем това ще ни отнеме още 2мм, ако имаме линия 10мм то 40% от времето ще ускоряваме и ще спираме, при ускорение 5000мм/с², то вече сме на 0.8мм, не звучи много, 
но когато имаме обекти с честа смяна на посоката това си оказва влияние.

## Когато завиваме не винаги ни се налага да спираме или какво е Jerk, Squere corner velocity и подобни.
Това е възможността на устройството да променя посоката си при завой в прав ъгъл, като това служи за основа за възможностите му да направи по-остър завой или по-плавен. Отново основното ограничение е мотора. Ако можем да завием с по-висока скорост, няма да има нужда да държим спирачката и в последствие да ускоряваме по-дълго след ъгъла. 

## Да добавим още няколко ограничения.
До сега гледахме на нещата от гледна точка на скорост, намерихме максималното което можем да направим, но качеството ако въобще печата го няма никакво.
- При резки промени в скоростта машината трепти и се получава "ехо"(Ghosting, Ringing) на ъгъла по продължение на права едно е да ускоряваш, често решенията са намаляване на скоростта и ускорението, с цел да се ограничат вибрациите. (Друга причина са разхлабени или некачествени ремъци и движения.) Съществува и софтуеърно решение (InputShaper), което се стреми да не позволява принтера да влиза в хармонични трептения.
- Налягане в дюзата - за да излиза материал трябва да има налягане в дюзата, при рязко ускорение и висока скорост принтерът прави по-тънка нишка (UnderExtrusion),
до достигане на оптимално налягане, а когато започне да спира се получава точно обратният ефект освобождава налягането при спиране и прави по-дебела нишка (OverExtrusion). Решението е или се намалява скоростта и ускорението, съответно се използват много близки скорости или се използва алгоритъм който да увеличи налягането на екструдера при ускорение и да намали налягането при спиране. (Pressure Advance, Linear Advance и пр.) Като тази стойност която се задава на алгоритъма варира спрямо материал, температура, дюза и тн. Примерно ако имаме 0.72 коефициент, то грубо при ускорение ще увеличава екструдираният материал. Ако целта ни е скорост от 90мм/с и екструдера избутва максимално по 35мм/с, то при ускорение ще се помъчи да избута над 35мм/с, което е над възможностите ни и трябва да смъкнем максималната скорост, до около 60мм/с. (Разбира се това е опростена формула, нещата са малко по сложни и примерно с клипер, има допуск още около 10-15%, та скоростта в нашият пример е 70мм/с)


## Финални думи.
- За високи скорости трябва активно да се коригира налягането в дюзата което от своя страна ограничава скоростта при дистанционен екструдер (Bowden) където има тръбичка след екструдера до главата стойностите на коефициента нормално се движи от 0.5 до над 1, при директни екструдери където екструдера е на главата тази стойност е между 0 и 0.4, което дава по-висока скорост, но поради увеличената маса на главата ускоренията падат и вибрациите се увеличават. 
- Тази математика е при идеални условия и основно за PLA като изключва първият слой, мостове, обратни наклони, слепване на материала, изстиването на материала еластичността на материала и тн. Някой материали не се поддават на толкова директно съотношение, но може да даде представа ако знаете с какви параметри печатате и искате да промените дебелината и височината на линията и представа какво и как се случва, защо параметъра скорост е толкова мех. 

## Материали.
-[Табличка за скоростите](https://docs.google.com/spreadsheets/d/1reUdOvrVpZviGmEmnvC4giYMgKwU9U2PYtte8ioz1T4/edit?usp=sharing)
-[По подробно разяснение със картинки и математика](https://github.com/Klipper3d/klipper/blob/master/docs/Kinematics.md)
